{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"I:\\\\Online_Store\\\\projectfrontend\\\\src\\\\core\\\\PaymentB.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect } from \"react\";\nimport { Redirect } from \"react-router-dom\";\nimport { cartEmpty } from \"./helper/cartHelper\";\nimport { getmeToken, processPayment } from \"./helper/paymentHelper\";\nimport { createOrder } from \"./helper/orderHelper\";\nimport { isAuthenticated, signout } from \"../auth/helper\";\nimport DropIn from \"braintree-web-drop-in-react\";\n\nconst PaymentB = ({\n  products,\n  reload = undefined,\n  setReload = f => f\n}) => {\n  _s();\n\n  const [info, setInfo] = useState({\n    loading: false,\n    success: false,\n    clientToken: null,\n    error: \"\",\n    instance: {}\n  });\n  const userId = isAuthenticated && isAuthenticated().user.id;\n  const token = isAuthenticated && isAuthenticated().token;\n\n  const getToken = (userId, token) => {\n    getmeToken(userId, token).then(info => {\n      if (info.error) {\n        setInfo({ ...info,\n          error: info.error\n        });\n        signout(() => {\n          return /*#__PURE__*/_jsxDEV(Redirect, {\n            to: \"/\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 35,\n            columnNumber: 32\n          }, this);\n        });\n      } else {\n        const clientToken = info.clientToken;\n        setInfo({\n          clientToken\n        });\n      }\n    });\n  };\n\n  useEffect(() => {\n    getToken(userId, token);\n  }, []);\n\n  const getAmount = () => {\n    let amount = 0;\n    products.map(p => {\n      amount = amount + parseInt(p.price);\n    });\n    return amount;\n  };\n\n  const onPurchase = () => {\n    setInfo({\n      loading: true\n    });\n    let nonce;\n    let getNonce = info.instance.requestPaymentMethod().then(data => {\n      console.log(\"MYDATA\", data);\n      nonce = data.nonce;\n      const paymentData = {\n        paymentMethodNonce: nonce,\n        amount: getAmount()\n      };\n      processPayment(userId, token, paymentData).then(response => {\n        console.log(\"POINT-1\", response);\n\n        if (response.error) {\n          if (response.code == \"1\") {\n            console.log(\"PAYMENT Failed!\");\n            signout(() => {\n              return /*#__PURE__*/_jsxDEV(Redirect, {\n                to: \"/\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 72,\n                columnNumber: 40\n              }, this);\n            });\n          }\n        } else {\n          setInfo({ ...info,\n            success: response.success,\n            loading: false\n          });\n          console.log(\"PAYMENT SUCCESS\");\n          let product_names = \"\";\n          products.forEach(function (item) {\n            product_names += item.name + \", \";\n          });\n          const orderData = {\n            products: product_names,\n            transaction_id: response.transaction.id,\n            amount: response.transaction.amount\n          };\n          createOrder(userId, token, orderData).then(response => {\n            if (response.error) {\n              if (response.code == \"1\") {\n                console.log(\"Order Failed!\");\n                signout(() => {\n                  return /*#__PURE__*/_jsxDEV(Redirect, {\n                    to: \"/\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 95,\n                    columnNumber: 52\n                  }, this);\n                });\n              }\n            } else {\n              if (response.success == true) {\n                console.log(\"ORDER PLACED!!\");\n              }\n            }\n          }).catch(error => {\n            setInfo({\n              loading: false,\n              success: false\n            });\n            console.log(\"Order FAILED\", error);\n          });\n          cartEmpty(() => {\n            console.log(\"Did we got a crash?\");\n          });\n          setReload(!reload);\n        }\n      }).catch(error => {\n        setInfo({\n          loading: false,\n          success: false\n        });\n        console.log(\"PAYMENT FAILED\", error);\n      });\n    });\n  };\n\n  const showbtnDropIn = () => {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: info.clientToken !== null && products.length > 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(DropIn, {\n          options: {\n            authorization: info.clientToken\n          },\n          onInstance: instance => info.instance = instance\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 128,\n          columnNumber: 29\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: onPurchase,\n          className: \"btn btn-block btn-success\",\n          children: \"Buy Now\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 133,\n          columnNumber: 29\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 127,\n        columnNumber: 25\n      }, this) : /*#__PURE__*/_jsxDEV(\"h3\", {\n        children: \"Please login first or add something in cart\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 142,\n        columnNumber: 25\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 13\n    }, this);\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n      children: [\"Your bill is $ \", getAmount()]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 13\n    }, this), showbtnDropIn()]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 149,\n    columnNumber: 9\n  }, this);\n};\n\n_s(PaymentB, \"3Vfwhf9Pd+YhtSz3K6VAk9QrTRg=\");\n\n_c = PaymentB;\nexport default PaymentB;\n\nvar _c;\n\n$RefreshReg$(_c, \"PaymentB\");","map":{"version":3,"sources":["I:/Online_Store/projectfrontend/src/core/PaymentB.js"],"names":["React","useState","useEffect","Redirect","cartEmpty","getmeToken","processPayment","createOrder","isAuthenticated","signout","DropIn","PaymentB","products","reload","undefined","setReload","f","info","setInfo","loading","success","clientToken","error","instance","userId","user","id","token","getToken","then","getAmount","amount","map","p","parseInt","price","onPurchase","nonce","getNonce","requestPaymentMethod","data","console","log","paymentData","paymentMethodNonce","response","code","product_names","forEach","item","name","orderData","transaction_id","transaction","catch","showbtnDropIn","length","authorization"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport { Redirect } from \"react-router-dom\";\r\nimport { cartEmpty } from \"./helper/cartHelper\";\r\nimport { getmeToken, processPayment } from \"./helper/paymentHelper\";\r\nimport { createOrder } from \"./helper/orderHelper\";\r\nimport { isAuthenticated, signout } from \"../auth/helper\";\r\n\r\nimport DropIn from \"braintree-web-drop-in-react\";\r\n\r\nconst PaymentB = ({\r\n    products,\r\n    reload = undefined,\r\n    setReload = (f) => f,\r\n}) => {\r\n    const [info, setInfo] = useState({\r\n        loading: false,\r\n        success: false,\r\n        clientToken: null,\r\n        error: \"\",\r\n        instance: {},\r\n    });\r\n\r\n    const userId = isAuthenticated && isAuthenticated().user.id;\r\n    const token = isAuthenticated && isAuthenticated().token;\r\n\r\n    const getToken = (userId, token) => {\r\n        getmeToken(userId, token)\r\n            .then((info) => {\r\n                if (info.error) {\r\n                    setInfo({\r\n                        ...info,\r\n                        error: info.error,\r\n                    });\r\n                    signout(() => {\r\n                        return <Redirect to=\"/\" />;\r\n                    });\r\n                } else {\r\n                    const clientToken = info.clientToken;\r\n                    setInfo({ clientToken });\r\n                }\r\n            });\r\n    };\r\n\r\n    useEffect(() => {\r\n        getToken(userId, token);\r\n    }, []);\r\n\r\n    const getAmount = () => {\r\n        let amount = 0;\r\n        products.map((p) => {\r\n            amount = amount + parseInt(p.price);\r\n        });\r\n        return amount;\r\n    };\r\n    const onPurchase = () => {\r\n        setInfo({ loading: true });\r\n        let nonce;\r\n        let getNonce = info.instance.requestPaymentMethod().then((data) => {\r\n            console.log(\"MYDATA\", data);\r\n            nonce = data.nonce;\r\n            const paymentData = {\r\n                paymentMethodNonce: nonce,\r\n                amount: getAmount(),\r\n            };\r\n            processPayment(userId, token, paymentData)\r\n                .then((response) => {\r\n                    console.log(\"POINT-1\", response);\r\n                    if (response.error) {\r\n                        if (response.code == \"1\") {\r\n                            console.log(\"PAYMENT Failed!\");\r\n                            signout(() => {\r\n                                return <Redirect to=\"/\" />;\r\n                            });\r\n                        }\r\n                    } else {\r\n                        setInfo({ ...info, success: response.success, loading: false });\r\n                        console.log(\"PAYMENT SUCCESS\");\r\n\r\n                        let product_names = \"\";\r\n                        products.forEach(function (item) {\r\n                            product_names += item.name + \", \";\r\n                        });\r\n\r\n                        const orderData = {\r\n                            products: product_names,\r\n                            transaction_id: response.transaction.id,\r\n                            amount: response.transaction.amount,\r\n                        };\r\n                        createOrder(userId, token, orderData)\r\n                            .then((response) => {\r\n                                if (response.error) {\r\n                                    if (response.code == \"1\") {\r\n                                        console.log(\"Order Failed!\");\r\n                                        signout(() => {\r\n                                            return <Redirect to=\"/\" />;\r\n                                        });\r\n                                    }\r\n                                } else {\r\n                                    if (response.success == true) {\r\n                                        console.log(\"ORDER PLACED!!\");\r\n                                    }\r\n                                }\r\n                            })\r\n                            .catch((error) => {\r\n                                setInfo({ loading: false, success: false });\r\n                                console.log(\"Order FAILED\", error);\r\n                            });\r\n                        cartEmpty(() => {\r\n                            console.log(\"Did we got a crash?\");\r\n                        });\r\n\r\n                        setReload(!reload);\r\n                    }\r\n                })\r\n                .catch((error) => {\r\n                    setInfo({ loading: false, success: false });\r\n                    console.log(\"PAYMENT FAILED\", error);\r\n                });\r\n        });\r\n    };\r\n\r\n    const showbtnDropIn = () => {\r\n        return (\r\n            <div>\r\n                {info.clientToken !== null && products.length > 0\r\n                    ? (\r\n                        <div>\r\n                            <DropIn\r\n                                options={{ authorization: info.clientToken }}\r\n                                onInstance={(instance) => (info.instance = instance)}\r\n                            >\r\n                            </DropIn>\r\n                            <button\r\n                                onClick={onPurchase}\r\n                                className=\"btn btn-block btn-success\"\r\n                            >\r\n                                Buy Now\r\n              </button>\r\n                        </div>\r\n                    )\r\n                    : (\r\n                        <h3>Please login first or add something in cart</h3>\r\n                    )}\r\n            </div>\r\n        );\r\n    };\r\n\r\n    return (\r\n        <div>\r\n            <h3>Your bill is $ {getAmount()}</h3>\r\n            {showbtnDropIn()}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default PaymentB;\r\n"]},"metadata":{},"sourceType":"module"}